<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Randomly pick a top rated movie</title>
  <link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap' rel='stylesheet'>
  <script src='https://cdn.tailwindcss.com'></script>
  <style>
    :root { --font-sans:'Inter', system-ui, sans-serif; --color-bg:#121212; --color-base:#1E1E1E; --color-card:#1F1F1F; --color-accent:#2DD4BF; --color-text:#E5E7EB; --radius:0.5rem; }
    html { background:var(--color-bg); color:var(--color-text); font-family:var(--font-sans); }
    body { min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:1rem 1rem 4rem; margin:0; }

    .randomizer { background:var(--color-card); border-radius:var(--radius); padding:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.5); width:100%; max-width:320px; display:flex; flex-direction:column; align-items:center; position:relative; }
    h1 { font-size:2.25rem; line-height:1.1; font-weight:700; margin-bottom:1.5rem; white-space:nowrap; letter-spacing:0.025em; }
    #posterWrapper { background:var(--color-base); border-radius:var(--radius); overflow:hidden; width:100%; aspect-ratio:2/3; margin-bottom:1.5rem; }
    #moviePoster { width:100%; height:100%; object-fit:contain; display:none; }

    .btn { display:block; width:100%; padding:0.75rem; background:var(--color-base); color:var(--color-text); font-weight:600; border:none; border-radius:var(--radius); font-size:0.875rem; transition:background 0.2s, transform 0.1s; cursor:pointer; margin-bottom:1rem; }
    .btn:disabled { opacity:0.6; cursor:default; }
    .btn:hover:not(:disabled), .btn:focus:not(:disabled) { background:var(--color-accent); color:#121212; transform:translateY(-2px); outline:none; }
    .btn:active { transform:translateY(0); }

    #result { text-align:center; margin-bottom:1rem; display:none; }
    #movieResult { font-weight:600; font-size:0.875rem; }

    .controls { width:100%; max-width:320px; display:flex; justify-content:space-between; align-items:center; margin-top:0.5rem; position:relative; }
    #genreToggle, #streamLink { font-size:0.875rem; font-weight:600; cursor:pointer; padding:0.25rem 0.5rem; border-radius:var(--radius); transition:background 150ms, text-decoration 150ms; }
    #genreToggle { color:var(--color-text); background:transparent; text-decoration:none; }
    #streamLink { color:var(--color-accent); background:transparent; text-decoration:none; }
    #streamLink:hover, #streamLink:focus { text-decoration:underline; background:rgba(45,212,191,0.1); outline:none; }

    /* Desktop dropdown */
    #genreMenu { position:absolute; bottom:100%; right:calc(100% + 0.25rem); transform-origin:bottom right; max-height:60vh; overflow-y:auto; background:var(--color-base); border-radius:var(--radius); box-shadow:0 4px 12px rgba(0,0,0,0.5); opacity:0; transform:translateY(0.5rem) scale(0.95); pointer-events:none; transition:opacity 150ms ease, transform 150ms ease; z-index:1000; }
    #genreMenu.open { opacity:1; transform:translateY(0) scale(1); pointer-events:auto; }
    #genreMenu .item { padding:0.5rem 1rem; display:flex; align-items:center; gap:0.5rem; font-size:0.875rem; cursor:pointer; transition:background 100ms; }
    #genreMenu .item:hover { background:#2D3748; }
    #genreMenu .check { visibility:hidden; color:#38A169; }
    #genreMenu .item.selected .check { visibility:visible; }

    /* Mobile bottom sheet */
    #genreSheet {
      position:fixed;
      left:0;
      right:0;
      bottom:-100%;
      /* ensure sheet doesn't overlap home indicator */
      height:50%;
      max-height:calc(50% - env(safe-area-inset-bottom));
      padding-bottom:env(safe-area-inset-bottom);
      background:var(--color-card);
      border-top-left-radius:var(--radius);
      border-top-right-radius:var(--radius);
      box-shadow:0 -4px 12px rgba(0,0,0,0.5);
      transition:bottom 200ms ease;
      z-index:2000;
      display:flex;
      flex-direction:column;
    }
    #genreSheet.active { bottom:0; }
    #genreSheet .sheet-header { padding:0.75rem 1rem; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #2E2E2E; }
    #genreSheet .sheet-header h2 { margin:0; font-size:1rem; font-weight:600; }
    #genreSheet .sheet-body { overflow-y:auto; flex:1; }
    #genreSheet .sheet-body .item { padding:0.75rem 1rem; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #2E2E2E; cursor:pointer; }
    #genreSheet .sheet-body .item.selected .check { visibility:visible; }

    /* Hide desktop menu on mobile */
    @media (max-width:450px) { #genreMenu { display:none!important; } }
  </style>
</head>
<body>
  <h1>Randomly pick a top rated movie</h1>
  <div class='randomizer'>
    <div id='posterWrapper'><img id='moviePoster' alt='Movie poster'></div>
    <button id='randomizeBtn' class='btn' disabled>
      <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A9 9 0 1 1 11 4.915m0 0V9h5" />
      </svg>
      <span class="btn-text">Loading…</span>
    </button>
    <div id='result'><div id='movieResult'></div></div>
  </div>

  <div class='controls'>
    <button id='genreToggle'>▾ Genres</button>
    <a id='streamLink' href='#' target='_blank'>Where to stream</a>
    <div id='genreMenu'></div>
  </div>

    <!-- Privacy Policy -->
  <a href="#" class="privacy-policy text-xs text-gray-400" style="position:absolute; bottom:1.5rem; right:0.5rem;">
    Privacy Policy
  </a>

  <!-- Attribution -->
  <div class="attribution text-xs text-gray-500" style="position:absolute; bottom:0.5rem; right:0.5rem;">
    Data provided by <a href="https://www.themoviedb.org" target="_blank" class="underline">TMDb</a>
  </div>

  <!-- Mobile Genre Bottom Sheet -->
  <div id='genreSheet'>
    <div class='sheet-header'>
      <h2>Select Genres</h2>
      <button id='sheetClose'>✕</button>
    </div>
    <div class='sheet-body'></div>
  </div>

  <script>
    const TMDB_BASE='https://www.themoviedb.org/movie';
    const spinCount=30, spinSpeed=20;
    let movies=[], selectedGenres=new Set([0]);
    const genreMap={0:'Any Genre',28:'Action',12:'Adventure',16:'Animation',35:'Comedy',80:'Crime',99:'Documentary',18:'Drama',10751:'Family',14:'Fantasy',36:'History',27:'Horror',10402:'Music',9648:'Mystery',10749:'Romance',878:'Sci-Fi',10770:'TV Movie',53:'Thriller',10752:'War',37:'Western'};

    const genreToggle=document.getElementById('genreToggle'), genreMenu=document.getElementById('genreMenu');
    const sheet=document.getElementById('genreSheet'), sheetBody=sheet.querySelector('.sheet-body'), sheetClose=document.getElementById('sheetClose');

    // Build both desktop and mobile lists
    Object.entries(genreMap).forEach(([id,name])=>{
      ['#genreMenu .item', '.sheet-body .item'].forEach((sel,index)=>{});
      // Desktop
      const dItem=document.createElement('div'); dItem.className='item'; dItem.dataset.genre=id; dItem.tabIndex=0;
      dItem.innerHTML=`<span>${name}</span><span class='check'>✓</span>`;
      dItem.addEventListener('click',()=>selectGenre(+id)); genreMenu.appendChild(dItem);
      // Mobile
      const mItem=document.createElement('div'); mItem.className='item'; mItem.dataset.genre=id;
      mItem.innerHTML=`<span>${name}</span><span class='check'>✓</span>`;
      mItem.addEventListener('click',()=>selectGenre(+id)); sheetBody.appendChild(mItem);
    });

    function selectGenre(id){
      if(id===0) selectedGenres=new Set([0]); else {
        if(selectedGenres.has(id)) selectedGenres.delete(id);
        else selectedGenres.add(id);
        selectedGenres.delete(0);
      }
      // Update visuals
      document.querySelectorAll('#genreMenu .item, #genreSheet .item').forEach(el=>{
        const gid=+el.dataset.genre;
        el.classList.toggle('selected', selectedGenres.has(gid) || (gid===0 && selectedGenres.has(0)));
      });
      sheet.classList.remove('active'); genreMenu.classList.remove('open'); randomize();
    }

    // Toggle
    genreToggle.addEventListener('click', e=>{
      if(window.innerWidth<=450) sheet.classList.add('active');
      else { e.stopPropagation(); genreMenu.classList.toggle('open'); }
    });
    sheetClose.addEventListener('click',()=>sheet.classList.remove('active'));
    document.addEventListener('click',()=>genreMenu.classList.remove('open'));

    // Randomizer core
    const btn=document.getElementById('randomizeBtn'), imgEl=document.getElementById('moviePoster'), res=document.getElementById('result'), txt=document.getElementById('movieResult'), linkEl=document.getElementById('streamLink');
    function randomize(){ if(!movies.length) return; let pool=movies; const gf=[...selectedGenres].filter(g=>g!==0); if(gf.length){ pool=pool.filter(m=>gf.every(id=>m.genre_ids.includes(id))); if(!pool.length) return showError('No movies match your genres.'); } const picks=pool.length>=spinCount?pool.sort(()=>0.5-Math.random()).slice(0,spinCount):Array.from({length:spinCount},()=>pool[Math.floor(Math.random()*pool.length)]); res.style.display='none'; imgEl.style.display='block'; imgEl.classList.add('slot-flip'); btn.disabled=true; let i=0; (function flip(){ const m=picks[i++]; imgEl.src=m.src; txt.textContent=`${m.title} (${m.year})`; if(i<picks.length) setTimeout(flip,spinSpeed); else { imgEl.classList.remove('slot-flip'); res.style.display='block'; btn.textContent='Randomize Movie'; btn.disabled=false; linkEl.href=`${TMDB_BASE}/${m.id}/watch?locale=US`; } })(); }
    function showError(msg){ res.style.display='block'; txt.textContent=msg; btn.textContent='Error'; btn.disabled=true; }
    fetch('data/movies.json').then(r=>r.ok?r.json():Promise.reject()).then(arr=>{ movies=arr.filter(m=>m.poster_path).map(m=>({ id:m.id, title:m.title, year:m.release_date?.slice(0,4)||'', src:`https://image.tmdb.org/t/p/w342${m.poster_path}`, genre_ids:m.genre_ids||[] })); btn.textContent='Randomize Movie'; btn.disabled=false; }).catch(e=>{ console.error(e); showError('Failed to load movie list.'); });
    btn.addEventListener('click',randomize);
  </script>
  <!-- Contact Us -->
  <a href="mailto:movierandomizertool@gmail.com"
     class="contact-us text-xs text-gray-400"
     style="position:absolute; bottom:0.5rem; left:0.5rem;">
    Contact Us
  </a>
</body>
</html>
