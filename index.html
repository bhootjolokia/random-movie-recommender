<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Randomly pick a top rated movie</title>
  <link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap' rel='stylesheet'>
  <script src='https://cdn.tailwindcss.com'></script>
  <style>
    /* Poster flip animation */
    @keyframes slotFlip { 0% { transform: rotateX(0deg); } 50% { transform: rotateX(90deg); } 100% { transform: rotateX(0deg); } }
    #moviePoster.slot-flip { animation: slotFlip 0.6s ease-in-out; backface-visibility: hidden; }

    :root {
      --font-sans: 'Inter', system-ui, sans-serif;
      --color-bg: #121212;
      --color-base: #1E1E1E;
      --color-card: #1F1F1F;
      --color-accent: #2DD4BF;
      --color-text: #E5E7EB;
      --radius: 0.5rem;
    }

    html { background: var(--color-bg); color: var(--color-text); font-family: var(--font-sans); }
    body { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; margin: 0; }
    h1 { font-size: 2.25rem; line-height: 1.1; font-weight: 700; margin-bottom: 1.5rem; letter-spacing: 0.025em; white-space: nowrap; }

    .randomizer {
      background: var(--color-card);
      border-radius: var(--radius);
      padding: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      width: 100%;
      max-width: 320px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: max-width 0.2s;
    }

    #posterWrapper { background: var(--color-base); border-radius: var(--radius); overflow: hidden; width: 100%; aspect-ratio: 2/3; margin-bottom: 1rem; }
    #moviePoster { display: none;  width: 100%; height: 100%; object-fit: contain; }

    .btn { width: 100%; padding: 0.75rem; background: var(--color-base); color: var(--color-text); font-weight: 600; border: none; border-radius: var(--radius); font-size: 0.875rem; transition: background 0.2s; cursor: pointer; margin-bottom: 1rem; }
    .btn:disabled { opacity: 0.6; cursor: default; }

    #result { display: none;  text-align: center; margin: 1rem 0; }
    #movieResult { font-weight: 600; font-size: 0.875rem; }

    .controls { width: 100%; max-width: 320px; display: flex; justify-content: space-between; margin-top: 1rem; }

    #genreToggle, #streamLink { font-size: 0.875rem; font-weight: 600; cursor: pointer; padding: 0.25rem 0.5rem; border-radius: var(--radius); }
  </style>
</head>
<body>
  <h1>Randomly pick a top rated movie</h1>
  <div class='randomizer'>
    <div id='posterWrapper'><img id='moviePoster' alt='Movie poster'></div>
    <button id='randomizeBtn' class='btn' disabled>Loading…</button>
  </div>

  <!-- Movie title appears below card -->
  <div id='result'><div id='movieResult'></div></div>

  <!-- Controls now just below the movie title -->
  <div class='controls'>
    <button id='genreToggle'>▾ Genres</button>
    <a id='streamLink' href='#' target='_blank'>Where to stream</a>
  </div>

  <script>
        const TMDB_BASE = 'https://www.themoviedb.org/movie';
    const spinCount = 30, spinSpeed = 20;
    let movies = [], selectedGenres = new Set([0]);

    // Fetch movies and enable button
    const btn = document.getElementById('randomizeBtn');
    fetch('data/movies.json')
      .then(r => r.ok ? r.json() : Promise.reject())
      .then(arr => {
        movies = arr.filter(m => m.poster_path).map(m => ({
          id: m.id,
          title: m.title,
          year: m.release_date?.slice(0,4) || '',
          src: `https://image.tmdb.org/t/p/w342${m.poster_path}`
        }));
        btn.textContent = 'Randomize Movie';
        btn.disabled = false;
      })
      .catch(() => { console.error('Failed to load movies'); });

    document.getElementById('randomizeBtn').addEventListener('click', () => {
      const img = document.getElementById('moviePoster');
      const res = document.getElementById('result');
      const txt = document.getElementById('movieResult');
      img.style.display = 'block';
      res.style.display = 'none';
      if (!movies.length) return;
      let picks = [...movies];
      const spins = Math.min(spinCount, picks.length);
      btn.disabled = true;
      let i = 0;
      (function flip() {
        const m = picks[Math.floor(Math.random()*picks.length)];
        img.src = m.src;
        txt.textContent = `${m.title} (${m.year})`;
        if (++i < spins) setTimeout(flip, spinSpeed);
        else {
          res.style.display = 'block';
          btn.disabled = false;
        }
      })();
    });
  </script>
</body>
</html>
